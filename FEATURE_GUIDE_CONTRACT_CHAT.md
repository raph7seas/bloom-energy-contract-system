# Contract AI Assistant - Visual Feature Guide

## Overview
The AI Assistant has been transformed into a contract-specific chat interface that allows you to select any contract and ask questions about it and its associated documents.

---

## How to Access

1. **Navigate to any contract** in your system
2. Click on the **"AI Assistant"** tab
3. You'll see the new Contract AI Assistant interface

---

## UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’¬ Contract AI Assistant                  â”‚
â”‚          Select a contract and ask questions about           â”‚
â”‚                    its documents                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Select Contract                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Choose a contract...                            â–¼   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  When you select a contract, you'll see:                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ Contract: [Contract Name]                         â”‚   â”‚
â”‚  â”‚    [X] document(s) available                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      CHAT MESSAGES                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  ğŸ¤– I'm ready to help you with questions about       â”‚   â”‚
â”‚  â”‚     the "[Contract Name]" contract. I have access    â”‚   â”‚
â”‚  â”‚     to [X] document(s)...                            â”‚   â”‚
â”‚  â”‚                                           10:30 AM   â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚                        What is the serial number? ğŸ‘¤ â”‚   â”‚
â”‚  â”‚                                           10:31 AM   â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  ğŸ¤– Based on the contract documents, the serial      â”‚   â”‚
â”‚  â”‚     number is [SERIAL_NUMBER] as found in            â”‚   â”‚
â”‚  â”‚     [Document Name].                                 â”‚   â”‚
â”‚  â”‚                                           10:31 AM   â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ask a question about this contract...               â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ğŸ“¤â”‚
â”‚  Press Enter to send, Shift+Enter for new line              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature Components

### 1. Contract Selector
- **Dropdown menu** showing all available contracts
- Displays: `[Contract Name] - [Client] ([Status])`
- Example: "Tech Campus PPA - Acme Corp (Active)"

### 2. Document Info Panel (appears after selection)
- Shows selected contract name
- Displays number of associated documents
- Loading indicator while fetching documents

### 3. Chat Interface
- **Welcome Message**: AI introduces itself and confirms document access
- **Message Bubbles**:
  - User messages (blue, right-aligned)
  - AI responses (gray, left-aligned)
  - Timestamps on each message
- **Auto-scroll**: Automatically scrolls to latest message

### 4. Input Area
- Multi-line text input
- Send button with icon
- Keyboard shortcuts:
  - `Enter`: Send message
  - `Shift+Enter`: New line
- Disabled during AI processing

---

## Example Questions You Can Ask

### Serial Numbers & Parts
```
â“ "What is the serial number?"
â“ "What parts are listed in the documents?"
â“ "What is the equipment serial number?"
```

### Financial Information
```
â“ "Who is the financier?"
â“ "What is the base rate?"
â“ "What are the payment terms?"
â“ "What is the escalation rate?"
â“ "What is the total contract value?"
```

### Contract Terms
```
â“ "What is the contract term length?"
â“ "When is the effective date?"
â“ "What are the warranty terms?"
â“ "What is the payment frequency?"
```

### Technical Details
```
â“ "What is the system capacity?"
â“ "What voltage level is specified?"
â“ "How many servers are included?"
â“ "What components are part of this system?"
```

### General Inquiries
```
â“ "Give me a summary of this contract"
â“ "What are the key terms?"
â“ "Are there any special conditions?"
â“ "What site is this for?"
```

---

## How It Works Behind the Scenes

### Data Flow

1. **Contract Selection**
   ```
   User selects contract
        â†“
   Frontend fetches contract details
        â†“
   Frontend fetches all associated documents
        â†“
   Frontend fetches content for each document
        â†“
   AI receives full context
   ```

2. **Question & Answer**
   ```
   User types question
        â†“
   Frontend sends to backend with:
     - User's question
     - Full contract data
     - All document contents
     - Conversation history (last 10 messages)
        â†“
   Backend (AnthropicProvider) builds context:
     - Adds contract metadata
     - Adds document contents
     - Creates specialized system prompt
        â†“
   Claude AI processes:
     - Reviews all provided information
     - Searches for relevant details
     - Generates specific answer
        â†“
   Response returns to frontend
        â†“
   Message displayed in chat
   ```

### AI Context Includes

**Contract Information:**
- Contract ID, Name, Client, Site
- Capacity, Term, Type, Status
- Total Value, Effective Date
- Financial Parameters (base rate, escalation, payment terms)
- Technical Parameters (voltage, servers, components)
- Operating Parameters (warranty, efficiency)

**Document Information:**
- Document title and filename
- Document type (PRIMARY, APPENDIX, AMENDMENT, etc.)
- Page count
- **Full document content** (up to 5000 chars per document)

---

## Visual States

### Empty State
When no contract is selected:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚            ğŸ’¬                       â”‚
â”‚       No Contract Selected          â”‚
â”‚                                     â”‚
â”‚   Select a contract above to        â”‚
â”‚   start asking questions            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Loading States

**Loading Contracts:**
```
â³ Loading contracts...
```

**Loading Documents:**
```
ğŸ“„ Contract: [Name]
   â³ Loading documents...
```

**AI Processing:**
```
[Gray bubble with spinning loader icon]
```

### Error State
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Failed to load contract details  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Features

### âœ… Context-Aware Responses
- AI only answers based on provided documents
- Clearly states when information isn't available
- References specific documents when citing information

### âœ… Conversation Memory
- Maintains last 10 messages for context
- Supports follow-up questions
- AI remembers what was discussed

### âœ… Document Integration
- Automatically loads ALL associated documents
- Includes document content in AI context
- Searches across all documents for answers

### âœ… Smart Prompting
- Specialized system prompts for contract questions
- Instructed to be specific and cite sources
- Trained on Bloom Energy contract terminology

### âœ… User-Friendly Design
- Clean, modern interface
- Responsive layout
- Clear loading states
- Helpful error messages

---

## Technical Details

### Files Modified/Created

1. **`src/components/contract/ContractChatAssistant.tsx`** (NEW)
   - Main chat component
   - Contract selector
   - Message display
   - Document fetching logic

2. **`src/components/contract/AIAssistantTab.tsx`** (MODIFIED)
   - Now renders ContractChatAssistant
   - Simplified from previous three-tab interface

3. **`server/src/services/ai/AnthropicProvider.js`** (ENHANCED)
   - Added `_buildChatSystemPrompt()` method
   - Added `_buildContractContextMessage()` method
   - Enhanced `chat()` method to handle contract context

### API Endpoints Used

- `GET /api/contracts` - Fetch all contracts
- `GET /api/contracts/:id` - Fetch specific contract
- `GET /api/contracts/:contractId/documents` - Fetch documents
- `GET /api/documents/:documentId/content` - Fetch document content
- `POST /api/ai/chat` - Send message to AI

---

## Testing the Feature

### Manual Testing Steps

1. **Start the application**
   ```bash
   npm run dev
   ```

2. **Navigate to a contract**
   - Go to Contracts page
   - Click on any contract
   - Click "AI Assistant" tab

3. **Select a contract from dropdown**

4. **Wait for documents to load**

5. **Ask test questions:**
   - "What is the client name?"
   - "What is the capacity?"
   - "Who is the financier?"
   - "What documents are available?"

6. **Verify responses:**
   - AI should cite specific information
   - AI should reference documents
   - AI should say "I don't know" if info isn't available

---

## Tips for Best Results

### âœ… DO:
- Ask specific questions
- Ask about one topic at a time
- Use follow-up questions for clarification
- Reference previous messages in conversation

### âŒ DON'T:
- Ask about information not in the documents
- Expect AI to calculate or perform complex operations
- Ask multiple unrelated questions at once

---

## Future Enhancements

Potential improvements for this feature:

1. **Document Search Highlighting**
   - Show which document contains the answer
   - Highlight relevant text in documents

2. **Export Conversation**
   - Save chat history
   - Export as PDF/text

3. **Quick Actions**
   - Suggested questions based on contract
   - Common queries as buttons

4. **Multi-Contract Comparison**
   - Compare multiple contracts
   - Answer questions across contracts

5. **Streaming Responses**
   - Real-time text generation
   - See AI "typing" effect

---

## Need Help?

If you encounter issues:

1. **Check browser console** for errors
2. **Verify API endpoints** are accessible
3. **Ensure Anthropic API key** is configured
4. **Check document upload status** in contract
5. **Try a different contract** to isolate issues

For more information, refer to the main README or contact support.
